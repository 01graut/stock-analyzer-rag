import{bD as K,bE as e,bF as xt,bG as Ne,bH as _t,bI as ft,r as l,bJ as Ge,bK as yt,bL as St,bM as Ct,bN as vt,bO as bt,bP as jt,bQ as wt,bR as kt,bS as Tt,bT as Nt,bU as Lt,bV as Le,bW as At}from"./vendor-9f580cb9.js";import{D as qe,S as C,I as Ae,P as It,T as he,a as Pt,B as _e,b as Et,c as le,d as Oe,C as Rt,e as Ie,L as Mt,f as Gt,g as qt,h as Pe,i as Ot,j as Bt,k as Ut,l as M,m as $t,n as Ft}from"./fluentui-react-eb607e90.js";import{e as Vt,E as Ht,f as Dt,g as Qt,D as zt}from"./fluentui-icons-13e46eed.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const r of d.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(o){if(o.ep)return;o.ep=!0;const d=n(o);fetch(o.href,d)}})();const Kt=".auth/me",Wt=".auth/refresh",Jt=".auth/logout?post_logout_redirect_uri=/";async function Xt(){const t=await fetch("/auth_setup");if(!t.ok)throw new Error(`auth setup response was not ok: ${t.status}`);return await t.json()}const $=await Xt(),P=$.useLogin,Q=$.requireAccessControl,Yt=$.msalConfig,Zt=$.loginRequest,es=$.tokenRequest,Be=()=>window.location.origin+$.msalConfig.auth.redirectUri,ts=()=>fetch(Wt).then(t=>t.ok?fetch(Kt).then(s=>s.ok?s.json().then(n=>n.length>0?{id_token:n[0].id_token,access_token:n[0].access_token,user_claims:n[0].user_claims.reduce((c,o)=>(c[o.typ]=o.val,c),{})}:null):null):null),G=await ts(),ss=()=>{window.location.href=Jt},pe=t=>t?.getActiveAccount()!=null||G!=null,me=t=>G?Promise.resolve(G.access_token):t.acquireTokenSilent({...es,redirectUri:Be()}).then(s=>s.accessToken).catch(s=>{console.log(s)});const ns="/assets/github-fab00c2d.svg",os="_layout_xmlks_1",as="_header_xmlks_7",rs="_headerContainer_xmlks_12",is="_headerTitleContainer_xmlks_20",cs="_headerLogo_xmlks_28",ls="_headerTitle_xmlks_20",us="_headerNavList_xmlks_37",ds="_headerNavPageLink_xmlks_43",hs="_headerNavPageLinkActive_xmlks_57",ps="_headerNavLeftMargin_xmlks_62",ms="_headerRightText_xmlks_66",gs="_microsoftLogo_xmlks_71",xs="_githubLogo_xmlks_76",v={layout:os,header:as,headerContainer:rs,headerTitleContainer:is,headerLogo:cs,headerTitle:ls,headerNavList:us,headerNavPageLink:ds,headerNavPageLinkActive:hs,headerNavLeftMargin:ps,headerRightText:ms,microsoftLogo:gs,githubLogo:xs},_s="_loginButton_m8yze_1",fs={loginButton:_s},ys=()=>{const{instance:t}=K(),s=t.getActiveAccount(),n=(s||G)!=null,c=()=>{t.loginPopup({...Zt,redirectUri:Be()}).catch(r=>console.log(r))},o=()=>{s?t.logoutPopup({mainWindowRedirectUri:"/",account:t.getActiveAccount()}).catch(r=>console.log(r)):ss()},d=`Logout
${s?.username??G?.user_claims?.preferred_username}`;return e.jsx(qe,{text:n?d:"Login",className:fs.loginButton,onClick:n?o:c})},Ee=()=>e.jsxs("div",{className:v.layout,children:[e.jsx("header",{className:v.header,role:"banner",children:e.jsxs("div",{className:v.headerContainer,children:[e.jsx(xt,{to:"/",className:v.headerTitleContainer,children:e.jsx("h3",{className:v.headerTitle,children:"StockGPT | Your Stock Analyst"})}),e.jsx("nav",{children:e.jsxs("ul",{className:v.headerNavList,children:[e.jsx("li",{children:e.jsx(Ne,{to:"/",className:({isActive:t})=>t?v.headerNavPageLinkActive:v.headerNavPageLink,children:"Chat"})}),e.jsx("li",{className:v.headerNavLeftMargin,children:e.jsx(Ne,{to:"/qa",className:({isActive:t})=>t?v.headerNavPageLinkActive:v.headerNavPageLink,children:"Ask a Stock Question"})}),e.jsx("li",{className:v.headerNavLeftMargin,children:e.jsx("a",{href:"https://aka.ms/entgptsearch",target:"_blank",title:"Github repository link",children:e.jsx("img",{src:ns,alt:"Github logo","aria-label":"Link to github repository",width:"20px",height:"20px",className:v.githubLogo})})})]})}),e.jsx("h4",{className:v.headerRightText,children:"Azure OpenAI + AI Search"}),P&&e.jsx(ys,{})]})}),e.jsx(_t,{})]}),Ss="_container_18ti9_1",Cs="_chatRoot_18ti9_8",vs="_chatContainer_18ti9_13",bs="_chatEmptyState_18ti9_21",js="_chatEmptyStateTitle_18ti9_31",ws="_chatEmptyStateSubtitle_18ti9_38",ks="_chatMessageStream_18ti9_54",Ts="_chatMessageGpt_18ti9_66",Ns="_chatMessageGptMinWidth_18ti9_73",Ls="_chatInput_18ti9_78",As="_chatAnalysisPanel_18ti9_91",Is="_chatSettingsSeparator_18ti9_99",Ps="_loadingLogo_18ti9_103",Es="_commandsContainer_18ti9_107",Rs="_commandButton_18ti9_112",m={container:Ss,chatRoot:Cs,chatContainer:vs,chatEmptyState:bs,chatEmptyStateTitle:js,chatEmptyStateSubtitle:ws,chatMessageStream:ks,chatMessageGpt:Ts,chatMessageGptMinWidth:Ns,chatInput:Ls,chatAnalysisPanel:As,chatSettingsSeparator:Is,loadingLogo:Ps,commandsContainer:Es,commandButton:Rs},Ms="/assets/wallstreet-unsplash-20a6d78b.jpeg",te="";function se(t){var s={"Content-Type":"application/json"};return P&&G==null&&t&&(s.Authorization=`Bearer ${t}`),s}async function Xn(t,s){const n=await fetch(`${te}/ask`,{method:"POST",headers:se(s),body:JSON.stringify(t)}),c=await n.json();if(n.status>299||!n.ok)throw Error(c.error||"Unknown error");return c}async function Gs(t){return await(await fetch(`${te}/config`,{method:"GET",headers:se(t)})).json()}async function qs(t,s){return await fetch(`${te}/chat`,{method:"POST",headers:se(s),body:JSON.stringify(t)})}function Ue(t){return`${te}/content/${t}`}var b=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(b||{}),I=(t=>(t.TextAndImages="textAndImages",t.Images="images",t.Texts="texts",t))(I||{}),T=(t=>(t.Embedding="embedding",t.ImageEmbedding="imageEmbedding",t.Both="both",t))(T||{});const Os="_answerContainer_1sqax_1",Bs="_answerLogo_1sqax_11",Us="_answerText_1sqax_15",$s="_selected_1sqax_34",Fs="_citationLearnMore_1sqax_38",Vs="_citation_1sqax_38",Hs="_followupQuestionsList_1sqax_60",Ds="_followupQuestionLearnMore_1sqax_64",Qs="_followupQuestion_1sqax_60",zs="_supContainer_1sqax_83",Ks="_retryButton_1sqax_112",Ws="_loadingdots_1sqax_134",Js="_loading_1sqax_134",j={answerContainer:Os,answerLogo:Bs,answerText:Us,selected:$s,citationLearnMore:Fs,citation:Vs,followupQuestionsList:Hs,followupQuestionLearnMore:Ds,followupQuestion:Qs,supContainer:zs,retryButton:Ks,loadingdots:Ws,loading:Js};function Xs(t,s,n){const c=[];let o=t.trim();if(s){let u=o.length;for(let p=o.length-1;p>=0&&o[p]!=="]";p--)if(o[p]==="["){u=p;break}o=o.substring(0,u)}return{answerHtml:o.split(/\[([^\]]+)\]/g).map((u,g)=>{if(g%2===0)return u;{let p;c.indexOf(u)!==-1?p=c.indexOf(u)+1:(c.push(u),p=c.length);const h=Ue(u);return ft(e.jsx("a",{className:"supContainer",title:u,onClick:()=>n(h),children:e.jsx("sup",{children:p})}))}}).join(""),citations:c}}const $e=()=>e.jsx(Vt,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),Re=({answer:t,isSelected:s,isStreaming:n,onCitationClicked:c,onThoughtProcessClicked:o,onSupportingContentClicked:d,onFollowupQuestionClicked:r,showFollowupQuestions:u})=>{const g=t.choices[0].context.followup_questions,p=t.choices[0].message.content,h=l.useMemo(()=>Xs(p,n,c),[t]),x=Ge.sanitize(h.answerHtml);return e.jsxs(C,{className:`${j.answerContainer} ${s&&j.selected}`,verticalAlign:"space-between",children:[e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx($e,{}),e.jsxs("div",{children:[e.jsx(Ae,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>o(),disabled:!t.choices[0].context.thoughts?.length}),e.jsx(Ae,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>d(),disabled:!t.choices[0].context.data_points})]})]})}),e.jsx(C.Item,{grow:!0,children:e.jsx("div",{className:j.answerText,dangerouslySetInnerHTML:{__html:x}})}),!!h.citations.length&&e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:j.citationLearnMore,children:"Citations:"}),h.citations.map((_,y)=>{const L=Ue(_);return e.jsx("a",{className:j.citation,title:_,onClick:()=>c(L),children:`${++y}. ${_}`},y)})]})}),!!g?.length&&u&&r&&e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,wrap:!0,className:`${h.citations.length?j.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:j.followupQuestionLearnMore,children:"Follow-up questions:"}),g.map((_,y)=>e.jsx("a",{className:j.followupQuestion,title:_,onClick:()=>r(_),children:`${_}`},y))]})})]})},Ys=()=>{const t=yt({from:{opacity:0},to:{opacity:1}});return e.jsx(St.div,{style:{...t},children:e.jsxs(C,{className:j.answerContainer,verticalAlign:"space-between",children:[e.jsx($e,{}),e.jsx(C.Item,{grow:!0,children:e.jsxs("p",{className:j.answerText,children:["Generating answer",e.jsx("span",{className:j.loadingdots})]})})]})})},Zs=({error:t,onRetry:s})=>e.jsxs(C,{className:j.answerContainer,verticalAlign:"space-between",children:[e.jsx(Ht,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(C.Item,{grow:!0,children:e.jsx("p",{className:j.answerText,children:t})}),e.jsx(It,{className:j.retryButton,onClick:s,text:"Retry"})]}),en="_questionInputContainer_hiipw_1",tn="_questionInputTextArea_hiipw_12",sn="_questionInputButtonsContainer_hiipw_17",ue={questionInputContainer:en,questionInputTextArea:tn,questionInputButtonsContainer:sn},nn=({onSend:t,disabled:s,placeholder:n,clearOnSend:c,initQuestion:o})=>{const[d,r]=l.useState("");l.useEffect(()=>{o&&r(o)},[o]);const u=()=>{s||!d.trim()||(t(d),c&&r(""))},g=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),u())},p=(y,L)=>{L?L.length<=1e3&&r(L):r("")},{instance:h}=K(),x=Q&&!pe(h),_=s||!d.trim()||x;return x&&(n="Please login to continue..."),e.jsxs(C,{horizontal:!0,className:ue.questionInputContainer,children:[e.jsx(he,{className:ue.questionInputTextArea,disabled:x,placeholder:n,multiline:!0,resizable:!1,borderless:!0,value:d,onChange:p,onKeyDown:g}),e.jsx("div",{className:ue.questionInputButtonsContainer,children:e.jsx(Pt,{content:"Ask question button",relationship:"label",children:e.jsx(_e,{size:"large",icon:e.jsx(Dt,{primaryFill:"rgba(115, 118, 225, 1)"}),disabled:_,onClick:u})})})]})},on="_examplesNavList_o3hyg_1",an="_example_o3hyg_1",rn="_exampleText_o3hyg_29",ge={examplesNavList:on,example:an,exampleText:rn},cn=({text:t,value:s,onClick:n})=>e.jsx("div",{className:ge.example,onClick:()=>n(s),children:e.jsx("p",{className:ge.exampleText,children:t})}),ln=["How would a specific change in market conditions (e.g., interest rate hike) impact ratings of my holdings?","What is the overall risk profile of my portfolio based on the RAG ratings of individual stocks?","Which stocks have received downgrades from analysts or experienced negative changes in their news sentiment?"],un=["Compare the impact of interest rates and GDP in financial markets.","What is the expected trend for the S&P 500 index over the next five years? Compare it to the past S&P 500 performance","Can you identify any correlation between oil prices and stock market trends?"],dn=({onExampleClicked:t,useGPT4V:s})=>e.jsx("ul",{className:ge.examplesNavList,children:(s?un:ln).map((n,c)=>e.jsx("li",{children:e.jsx(cn,{text:n,value:n,onClick:t})},c))}),hn="_container_1p3pb_1",pn="_message_1p3pb_9",Me={container:hn,message:pn},ee=({message:t})=>e.jsx("div",{className:Me.container,children:e.jsx("div",{className:Me.message,children:t})}),mn="_thoughtProcess_1nmyh_1",gn="_tList_1nmyh_8",xn="_tListItem_1nmyh_14",_n="_tStep_1nmyh_40",fn="_tCodeBlock_1nmyh_46",yn="_tProp_1nmyh_50",Sn="_citationImg_1nmyh_58",U={thoughtProcess:mn,tList:gn,tListItem:xn,tStep:_n,tCodeBlock:fn,tProp:yn,citationImg:Sn};function Cn(t){const s=t.split(": "),n=s[0],c=Ge.sanitize(s.slice(1).join(": "));return{title:n,content:c}}const vn="_supportingContentNavList_beb5d_1",bn="_supportingContentItem_beb5d_9",jn="_supportingContentItemHeader_beb5d_23",wn="_supportingContentItemText_beb5d_27",kn="_supportingContentItemImage_beb5d_32",z={supportingContentNavList:vn,supportingContentItem:bn,supportingContentItemHeader:jn,supportingContentItemText:wn,supportingContentItemImage:kn},Tn=({supportingContent:t})=>{const s=Array.isArray(t)?t:t.text,n=Array.isArray(t)?[]:t?.images;return e.jsxs("ul",{className:z.supportingContentNavList,children:[s.map(c=>{const o=Cn(c);return e.jsx(Nn,{...o})}),n?.map(c=>e.jsx("img",{className:z.supportingContentItemImage,src:c.url}))]})},Nn=({title:t,content:s})=>e.jsxs("li",{className:z.supportingContentItem,children:[e.jsx("h4",{className:z.supportingContentItemHeader,children:t}),e.jsx("p",{className:z.supportingContentItemText,dangerouslySetInnerHTML:{__html:s}})]});var N=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(N||{});const Ln=({thoughts:t})=>e.jsx("ul",{className:U.tList,children:t.map(s=>e.jsxs("li",{className:U.tListItem,children:[e.jsx("div",{className:U.tStep,children:s.title}),Array.isArray(s.description)?e.jsx(Ct,{language:"json",wrapLongLines:!0,className:U.tCodeBlock,children:JSON.stringify(s.description,null,2)}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.description}),e.jsx(C,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(n=>e.jsxs("span",{className:U.tProp,children:[n,": ",JSON.stringify(s.props?.[n])]}))})]})]}))}),de={disabled:!0,style:{color:"grey"}},An=({answer:t,activeTab:s,activeCitation:n,citationHeight:c,className:o,onActiveTabChanged:d})=>{const r=!t.choices[0].context.thoughts,u=!t.choices[0].context.data_points,g=!n,[p,h]=l.useState(""),x=P?K().instance:void 0,_=async()=>{const y=x?await me(x):void 0;if(n){const ne=await(await fetch(n,{method:"GET",headers:se(y)})).blob(),q=URL.createObjectURL(ne);h(q)}};return l.useEffect(()=>{_()},[]),e.jsxs(Et,{className:o,selectedKey:s,onLinkClick:y=>y&&d(y.props.itemKey),children:[e.jsx(le,{itemKey:N.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:r?de:void 0,children:e.jsx(Ln,{thoughts:t.choices[0].context.thoughts||[]})}),e.jsx(le,{itemKey:N.SupportingContentTab,headerText:"Supporting content",headerButtonProps:u?de:void 0,children:e.jsx(Tn,{supportingContent:t.choices[0].context.data_points})}),e.jsx(le,{itemKey:N.CitationTab,headerText:"Citation",headerButtonProps:g?de:void 0,children:n?.endsWith(".png")?e.jsx("img",{src:p,className:U.citationImg}):e.jsx("iframe",{title:"Citation",src:p,width:"100%",height:c})})]})},In="_container_cfwv2_1",Pn={container:In},En=({className:t,onClick:s})=>e.jsx("div",{className:`${Pn.container} ${t??""}`,children:e.jsx(_e,{icon:e.jsx(Qt,{}),onClick:s,children:"Developer settings"})}),Rn="_container_cfwv2_1",Mn={container:Rn},Gn=({className:t,disabled:s,onClick:n})=>e.jsx("div",{className:`${Mn.container} ${t??""}`,children:e.jsx(_e,{icon:e.jsx(zt,{}),disabled:s,onClick:n,children:"Clear chat"})}),qn="_container_1pzrp_1",On={container:qn},Bn=[{key:T.Embedding,text:"Text Embeddings"},{key:T.ImageEmbedding,text:"Image Embeddings"},{key:T.Both,text:"Text and Image embeddings"}],Un=({updateRetrievalMode:t,updateVectorFields:s,showImageOptions:n})=>{const[c,o]=l.useState(b.Hybrid),[d,r]=l.useState(),u=(p,h)=>{o(h?.data||b.Hybrid),t(h?.data||b.Hybrid)},g=(p,h)=>{h&&r(h.key);let x;h?.key==="both"?x=[T.Embedding,T.ImageEmbedding]:x=[h?.key],s(x)};return l.useEffect(()=>{s(n?[T.Embedding,T.ImageEmbedding]:[T.Embedding])},[n]),e.jsxs(C,{className:On.container,tokens:{childrenGap:10},children:[e.jsx(Oe,{label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:c==b.Hybrid,data:b.Hybrid},{key:"vectors",text:"Vectors",selected:c==b.Vectors,data:b.Vectors},{key:"text",text:"Text",selected:c==b.Text,data:b.Text}],required:!0,onChange:u}),n&&[b.Vectors,b.Hybrid].includes(c)&&e.jsx(Rt,{options:Bn,onChange:g,selectedKey:d,defaultSelectedKey:T.Both,label:"Vector Fields (Multi-query vector search)"})]})},$n=()=>{const{instance:t}=K(),s=t.getActiveAccount(),n=r=>typeof r=="string"?r:JSON.stringify(r),o=(r=>Object.keys(r??{}).map(u=>{let g=u;try{const h=new URL(u).pathname.split("/");u=h[h.length-1]}catch{}return{name:u,value:n((r??{})[g])}}))(s?.idTokenClaims??G?.user_claims),d=[Ie({columnId:"name",compare:(r,u)=>r.name.localeCompare(u.name),renderHeaderCell:()=>"Name",renderCell:r=>r.name}),Ie({columnId:"value",compare:(r,u)=>r.value.localeCompare(u.value),renderHeaderCell:()=>"Value",renderCell:r=>r.value})];return e.jsxs("div",{children:[e.jsx(Mt,{children:"ID Token Claims"}),e.jsxs(Gt,{items:o,columns:d,sortable:!0,getRowId:r=>r.name,children:[e.jsx(qt,{children:e.jsx(Pe,{children:({renderHeaderCell:r})=>e.jsx(Ot,{children:r()})})}),e.jsx(Bt,{children:({item:r,rowId:u})=>e.jsx(Pe,{children:({renderCell:g})=>e.jsx(Ut,{children:g(r)})},u)})]})]})},Fn="_container_1pzrp_1",Vn={container:Fn},Hn=({updateGPT4VInputs:t,updateUseGPT4V:s,isUseGPT4V:n,gpt4vInputs:c})=>{const[o,d]=l.useState(n),[r,u]=l.useState(c||I.TextAndImages),g=(h,x)=>{s(!!x),d(!!x)},p=(h,x)=>{if(x){const _=x.key;t(_||I.TextAndImages),_&&u(_)}};return l.useEffect(()=>{o&&t(I.TextAndImages)},[o]),e.jsxs(C,{className:Vn.container,tokens:{childrenGap:10},children:[e.jsx(M,{checked:o,label:"Use GPT-4 Turbo with Vision",onChange:g}),o&&e.jsx(Oe,{selectedKey:r,label:"GPT-4 Turbo with Vision Inputs",options:[{key:I.TextAndImages,text:"Images and text from index"},{text:"Images only",key:I.Images},{text:"Text only",key:I.Texts}],required:!0,onChange:p})]})},Dn=()=>{const[t,s]=l.useState(!1),[n,c]=l.useState(""),[o,d]=l.useState(3),[r,u]=l.useState(b.Hybrid),[g,p]=l.useState(!0),[h,x]=l.useState(!0),[_,y]=l.useState(!1),[L,ne]=l.useState(""),[q,Fe]=l.useState(!1),[Ve,He]=l.useState([T.Embedding]),[fe,De]=l.useState(!1),[ye,Qe]=l.useState(!1),[Se,ze]=l.useState(I.TextAndImages),[W,Ke]=l.useState(!1),E=l.useRef(""),oe=l.useRef(null),[J,X]=l.useState(!1),[Ce,ae]=l.useState(!1),[Y,re]=l.useState(),[ve,ie]=l.useState(),[F,O]=l.useState(void 0),[V,be]=l.useState(0),[w,Z]=l.useState([]),[je,we]=l.useState([]),[ke,We]=l.useState(!1),[Je,Xe]=l.useState(!1),[Ye,Ze]=l.useState(!1),et=async()=>{const i=B?await me(B):void 0;Gs(i).then(a=>{We(a.showGPT4VOptions),p(a.showSemanticRankerOption),Xe(a.showSemanticRankerOption),Ze(a.showVectorOption),a.showVectorOption||u(b.Text)})},tt=async(i,a,k,ce)=>{let A="",f={};const pt=S=>new Promise(mt=>{setTimeout(()=>{A+=S;const gt={...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]};we([...a,[i,gt]]),mt(null)},33)});try{ae(!0);for await(const S of vt(ce))if(S.choices&&S.choices[0].context&&S.choices[0].context.data_points)S.choices[0].message=S.choices[0].delta,f=S;else if(S.choices&&S.choices[0].delta.content)X(!1),await pt(S.choices[0].delta.content);else if(S.choices&&S.choices[0].context)f.choices[0].context={...f.choices[0].context,...S.choices[0].context};else if(S.error)throw Error(S.error)}finally{ae(!1)}return{...f,choices:[{...f.choices[0],message:{content:A,role:f.choices[0].message.role}}]}},B=P?K().instance:void 0,H=async i=>{E.current=i,Y&&re(void 0),X(!0),ie(void 0),O(void 0);const a=B?await me(B):void 0;try{const ce={messages:[...w.flatMap(f=>[{content:f[0],role:"user"},{content:f[1].choices[0].message.content,role:"assistant"}]),{content:i,role:"user"}],stream:h,context:{overrides:{prompt_template:n.length===0?void 0:n,exclude_category:L.length===0?void 0:L,top:o,retrieval_mode:r,semantic_ranker:g,semantic_captions:_,suggest_followup_questions:q,use_oid_security_filter:fe,use_groups_security_filter:ye,vector_fields:Ve,use_gpt4v:W,gpt4v_input:Se}},session_state:w.length?w[w.length-1][1].choices[0].session_state:null},A=await qs(ce,a);if(!A.body)throw Error("No response body");if(h){const f=await tt(i,w,Z,A.body);Z([...w,[i,f]])}else{const f=await A.json();if(A.status>299||!A.ok)throw Error(f.error||"Unknown error");Z([...w,[i,f]])}}catch(k){re(k)}finally{X(!1)}},st=()=>{E.current="",Y&&re(void 0),ie(void 0),O(void 0),Z([]),we([]),X(!1),ae(!1)};l.useEffect(()=>oe.current?.scrollIntoView({behavior:"smooth"}),[J]),l.useEffect(()=>oe.current?.scrollIntoView({behavior:"auto"}),[je]),l.useEffect(()=>{et()},[]);const nt=(i,a)=>{c(a||"")},ot=(i,a)=>{d(parseInt(a||"3"))},at=(i,a)=>{p(!!a)},rt=(i,a)=>{y(!!a)},it=(i,a)=>{x(!!a)},ct=(i,a)=>{ne(a||"")},lt=(i,a)=>{Fe(!!a)},ut=(i,a)=>{De(!!a)},dt=(i,a)=>{Qe(!!a)},ht=i=>{H(i)},Te=(i,a)=>{ve===i&&F===N.CitationTab&&V===a?O(void 0):(ie(i),O(N.CitationTab)),be(a)},D=(i,a)=>{O(F===i&&V===a?void 0:i),be(a)};return e.jsxs("div",{className:m.container,children:[e.jsxs("div",{className:m.commandsContainer,children:[e.jsx(Gn,{className:m.commandButton,onClick:st,disabled:!E.current||J}),e.jsx(En,{className:m.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:m.chatRoot,children:[e.jsxs("div",{className:m.chatContainer,children:[E.current?e.jsxs("div",{className:m.chatMessageStream,children:[Ce&&je.map((i,a)=>e.jsxs("div",{children:[e.jsx(ee,{message:i[0]}),e.jsx("div",{className:m.chatMessageGpt,children:e.jsx(Re,{isStreaming:!0,answer:i[1],isSelected:!1,onCitationClicked:k=>Te(k,a),onThoughtProcessClicked:()=>D(N.ThoughtProcessTab,a),onSupportingContentClicked:()=>D(N.SupportingContentTab,a),onFollowupQuestionClicked:k=>H(k),showFollowupQuestions:q&&w.length-1===a},a)})]},a)),!Ce&&w.map((i,a)=>e.jsxs("div",{children:[e.jsx(ee,{message:i[0]}),e.jsx("div",{className:m.chatMessageGpt,children:e.jsx(Re,{isStreaming:!1,answer:i[1],isSelected:V===a&&F!==void 0,onCitationClicked:k=>Te(k,a),onThoughtProcessClicked:()=>D(N.ThoughtProcessTab,a),onSupportingContentClicked:()=>D(N.SupportingContentTab,a),onFollowupQuestionClicked:k=>H(k),showFollowupQuestions:q&&w.length-1===a},a)})]},a)),J&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{message:E.current}),e.jsx("div",{className:m.chatMessageGptMinWidth,children:e.jsx(Ys,{})})]}),Y?e.jsxs(e.Fragment,{children:[e.jsx(ee,{message:E.current}),e.jsx("div",{className:m.chatMessageGptMinWidth,children:e.jsx(Zs,{error:Y.toString(),onRetry:()=>H(E.current)})})]}):null,e.jsx("div",{ref:oe})]}):e.jsxs("div",{className:m.chatEmptyState,children:[e.jsx("img",{width:"30%",height:"30%",src:Ms}),e.jsx("h1",{className:m.chatEmptyStateTitle,children:"Chat with Stock data"}),e.jsx("h2",{className:m.chatEmptyStateSubtitle,children:" Try me"}),e.jsx(dn,{onExampleClicked:ht,useGPT4V:W})]}),e.jsx("div",{className:m.chatInput,children:e.jsx(nn,{clearOnSend:!0,placeholder:"Type a new question (e.g. Any news on Apple Stock?)",disabled:J,onSend:i=>H(i)})})]}),w.length>0&&F&&e.jsx(An,{className:m.chatAnalysisPanel,activeCitation:ve,onActiveTabChanged:i=>D(i,V),citationHeight:"810px",answer:w[V][1],activeTab:F}),e.jsxs($t,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(qe,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(he,{className:m.chatSettingsSeparator,defaultValue:n,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:nt}),e.jsx(Ft,{className:m.chatSettingsSeparator,label:"Retrieve this many search results:",min:1,max:50,defaultValue:o.toString(),onChange:ot}),e.jsx(he,{className:m.chatSettingsSeparator,label:"Exclude category",onChange:ct}),Je&&e.jsx(M,{className:m.chatSettingsSeparator,checked:g,label:"Use semantic ranker for retrieval",onChange:at}),e.jsx(M,{className:m.chatSettingsSeparator,checked:_,label:"Use query-contextual summaries instead of whole documents",onChange:rt,disabled:!g}),e.jsx(M,{className:m.chatSettingsSeparator,checked:q,label:"Suggest follow-up questions",onChange:lt}),ke&&e.jsx(Hn,{gpt4vInputs:Se,isUseGPT4V:W,updateUseGPT4V:i=>{Ke(i)},updateGPT4VInputs:i=>ze(i)}),Ye&&e.jsx(Un,{showImageOptions:W&&ke,updateVectorFields:i=>He(i),updateRetrievalMode:i=>u(i)}),P&&e.jsx(M,{className:m.chatSettingsSeparator,checked:fe||Q,label:"Use oid security filter",disabled:!pe(B)||Q,onChange:ut}),P&&e.jsx(M,{className:m.chatSettingsSeparator,checked:ye||Q,label:"Use groups security filter",disabled:!pe(B)||Q,onChange:dt}),e.jsx(M,{className:m.chatSettingsSeparator,checked:h,label:"Stream chat completion responses",onChange:it}),P&&e.jsx($n,{})]})]})]})};var xe;if(P){var R=new bt(Yt);!R.getActiveAccount()&&R.getAllAccounts().length>0&&R.setActiveAccount(R.getActiveAccount()),R.addEventCallback(t=>{if(t.eventType===jt.LOGIN_SUCCESS&&t.payload){const s=t.payload;R.setActiveAccount(s)}}),xe=e.jsx(At,{instance:R,children:e.jsx(Ee,{})})}else xe=e.jsx(Ee,{});wt();const Qn=kt([{path:"/",element:xe,children:[{index:!0,element:e.jsx(Dn,{})},{path:"qa",lazy:()=>Le(()=>import("./Ask-f3e41960.js"),["assets/Ask-f3e41960.js","assets/vendor-9f580cb9.js","assets/fluentui-react-eb607e90.js","assets/fluentui-icons-13e46eed.js","assets/Ask-4461589d.css"])},{path:"*",lazy:()=>Le(()=>import("./NoPage-190ef3d9.js"),["assets/NoPage-190ef3d9.js","assets/vendor-9f580cb9.js"])}]}]);Tt.createRoot(document.getElementById("root")).render(e.jsx(Nt.StrictMode,{children:e.jsx(Lt,{router:Qn})}));export{Re as A,dn as E,I as G,nn as Q,b as R,En as S,$n as T,T as V,N as a,Zs as b,An as c,Hn as d,Un as e,Gs as f,me as g,Xn as h,pe as i,Q as r,P as u};
//# sourceMappingURL=index-1cc27a6f.js.map
