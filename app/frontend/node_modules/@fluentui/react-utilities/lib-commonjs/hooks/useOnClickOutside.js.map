{"version":3,"sources":["useOnClickOutside.js"],"sourcesContent":["import * as React from 'react';\nimport { useEventCallback } from './useEventCallback';\nconst DEFAULT_CONTAINS = (parent, child)=>!!(parent === null || parent === void 0 ? void 0 : parent.contains(child));\n/**\n * @internal\n * Utility to perform checks where a click/touch event was made outside a component\n */ export const useOnClickOutside = (options)=>{\n    const { refs, callback, element, disabled, disabledFocusOnIframe, contains = DEFAULT_CONTAINS } = options;\n    const timeoutId = React.useRef(undefined);\n    useIFrameFocus({\n        element,\n        disabled: disabledFocusOnIframe || disabled,\n        callback,\n        refs,\n        contains\n    });\n    const isMouseDownInsideRef = React.useRef(false);\n    const listener = useEventCallback((ev)=>{\n        if (isMouseDownInsideRef.current) {\n            isMouseDownInsideRef.current = false;\n            return;\n        }\n        const target = ev.composedPath()[0];\n        const isOutside = refs.every((ref)=>!contains(ref.current || null, target));\n        if (isOutside && !disabled) {\n            callback(ev);\n        }\n    });\n    const handleMouseDown = useEventCallback((ev)=>{\n        // Selecting text from inside to outside will rigger click event.\n        // In this case click event target is outside but mouse down event target is inside.\n        // And this click event should be considered as inside click.\n        isMouseDownInsideRef.current = refs.some((ref)=>contains(ref.current || null, ev.target));\n    });\n    React.useEffect(()=>{\n        if (disabled) {\n            return;\n        }\n        // Store the current event to avoid triggering handlers immediately\n        // Note this depends on a deprecated but extremely well supported quirk of the web platform\n        // https://github.com/facebook/react/issues/20074\n        let currentEvent = getWindowEvent(window);\n        const conditionalHandler = (event)=>{\n            // Skip if this event is the same as the one running when we added the handlers\n            if (event === currentEvent) {\n                currentEvent = undefined;\n                return;\n            }\n            listener(event);\n        };\n        // use capture phase because React can update DOM before the event bubbles to the document\n        element === null || element === void 0 ? void 0 : element.addEventListener('click', conditionalHandler, true);\n        element === null || element === void 0 ? void 0 : element.addEventListener('touchstart', conditionalHandler, true);\n        element === null || element === void 0 ? void 0 : element.addEventListener('contextmenu', conditionalHandler, true);\n        element === null || element === void 0 ? void 0 : element.addEventListener('mousedown', handleMouseDown, true);\n        // Garbage collect this event after it's no longer useful to avoid memory leaks\n        timeoutId.current = window.setTimeout(()=>{\n            currentEvent = undefined;\n        }, 1);\n        return ()=>{\n            element === null || element === void 0 ? void 0 : element.removeEventListener('click', conditionalHandler, true);\n            element === null || element === void 0 ? void 0 : element.removeEventListener('touchstart', conditionalHandler, true);\n            element === null || element === void 0 ? void 0 : element.removeEventListener('contextmenu', conditionalHandler, true);\n            element === null || element === void 0 ? void 0 : element.removeEventListener('mousedown', handleMouseDown, true);\n            clearTimeout(timeoutId.current);\n            currentEvent = undefined;\n        };\n    }, [\n        listener,\n        element,\n        disabled,\n        handleMouseDown\n    ]);\n};\nconst getWindowEvent = (target)=>{\n    if (target) {\n        var _target_ownerDocument_defaultView, _target_ownerDocument;\n        if (typeof target.window === 'object' && target.window === target) {\n            // eslint-disable-next-line deprecation/deprecation\n            return target.event;\n        }\n        var _target_ownerDocument_defaultView_event;\n        // eslint-disable-next-line deprecation/deprecation\n        return (_target_ownerDocument_defaultView_event = (_target_ownerDocument = target.ownerDocument) === null || _target_ownerDocument === void 0 ? void 0 : (_target_ownerDocument_defaultView = _target_ownerDocument.defaultView) === null || _target_ownerDocument_defaultView === void 0 ? void 0 : _target_ownerDocument_defaultView.event) !== null && _target_ownerDocument_defaultView_event !== void 0 ? _target_ownerDocument_defaultView_event : undefined;\n    }\n    return undefined;\n};\nconst FUI_FRAME_EVENT = 'fuiframefocus';\n/**\n * Since click events do not propagate past iframes, we use focus to detect if a\n * click has happened inside an iframe, since the only ways of focusing inside an\n * iframe are:\n *   - clicking inside\n *   - tabbing inside\n *\n * Polls the value of `document.activeElement`. If it is an iframe, then dispatch\n * a custom DOM event. When the custom event is received call the provided callback\n */ const useIFrameFocus = (options)=>{\n    const { disabled, element: targetDocument, callback, contains = DEFAULT_CONTAINS, pollDuration = 1000, refs } = options;\n    const timeoutRef = React.useRef();\n    const listener = useEventCallback((e)=>{\n        const isOutside = refs.every((ref)=>!contains(ref.current || null, e.target));\n        if (isOutside && !disabled) {\n            callback(e);\n        }\n    });\n    // Adds listener to the custom iframe focus event\n    React.useEffect(()=>{\n        if (disabled) {\n            return;\n        }\n        targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.addEventListener(FUI_FRAME_EVENT, listener, true);\n        return ()=>{\n            targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.removeEventListener(FUI_FRAME_EVENT, listener, true);\n        };\n    }, [\n        targetDocument,\n        disabled,\n        listener\n    ]);\n    // Starts polling for the active element\n    React.useEffect(()=>{\n        var _targetDocument_defaultView;\n        if (disabled) {\n            return;\n        }\n        timeoutRef.current = targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.setInterval(()=>{\n            const activeElement = targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.activeElement;\n            if ((activeElement === null || activeElement === void 0 ? void 0 : activeElement.tagName) === 'IFRAME' || (activeElement === null || activeElement === void 0 ? void 0 : activeElement.tagName) === 'WEBVIEW') {\n                const event = new CustomEvent(FUI_FRAME_EVENT, {\n                    bubbles: true\n                });\n                activeElement.dispatchEvent(event);\n            }\n        }, pollDuration);\n        return ()=>{\n            var _targetDocument_defaultView;\n            targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.clearTimeout(timeoutRef.current);\n        };\n    }, [\n        targetDocument,\n        disabled,\n        pollDuration\n    ]);\n};\n"],"names":["useOnClickOutside","DEFAULT_CONTAINS","parent","child","contains","options","refs","callback","element","disabled","disabledFocusOnIframe","timeoutId","React","useRef","undefined","useIFrameFocus","isMouseDownInsideRef","listener","useEventCallback","ev","current","target","composedPath","isOutside","every","ref","handleMouseDown","some","useEffect","currentEvent","getWindowEvent","window","conditionalHandler","event","addEventListener","setTimeout","removeEventListener","clearTimeout","_target_ownerDocument_defaultView","_target_ownerDocument","_target_ownerDocument_defaultView_event","ownerDocument","defaultView","FUI_FRAME_EVENT","targetDocument","pollDuration","timeoutRef","e","_targetDocument_defaultView","setInterval","activeElement","tagName","CustomEvent","bubbles","dispatchEvent"],"mappings":"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"}